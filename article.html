<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js"></script>
    <title>The Blog of good1210's</title>
</head>
<link rel="stylesheet" href="init/main.css">
<style>
    @font-face {
    font-family: '楷体';
    src: url("init/simkai.ttf");
}
    @font-face {
        font-family: 'Consolas normal';
        src: url("init/consola.ttf");
    }
</style>

<body style="font-family: 'Consolas normal', '楷体';">
    <a href="index.html" class="back-btn">返回首页</a>
    <div class="date" id="articleDate"></div>
    <h1 style="text-align: center; color: white;" class="title" id="articleTitle"></h1>
    <div style="color: white;" class="article-content">
      <div class="markdown" id="articleContent">
        <!-- Markdown内容将在这里渲染 -->
        <div class="loading">加载文章中...</div>
      </div>
    </div>
</body>
<script>
    // 从URL参数获取日期文件夹名
    function getFolderFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('folder');
    }

    // 初始化：加载文章内容
    async function init() {
      const folder = getFolderFromUrl();
      
      if (!folder) {
        document.getElementById('articleContent').innerHTML = '<div>无效的文章路径</div>';
        return;
      }

      try {
        // 加载文章信息（标题、摘要等）
        const infoResponse = await fetch(`article/${folder}/info.json`);
        if (!infoResponse.ok) throw new Error('文章信息不存在');
        const info = await infoResponse.json();

        // 加载Markdown内容
        const contentResponse = await fetch(`article/${folder}/content.md`);
        if (!contentResponse.ok) throw new Error('文章内容不存在');
        const markdownContent = await contentResponse.text();

        // 渲染页面
        document.getElementById('articleTitle').textContent = info.title;
        document.getElementById('articleDate').textContent = formatDate(folder);
        // 将Markdown转换为HTML并渲染
        document.getElementById('articleContent').innerHTML = marked.parse(markdownContent);

        // 解析完成后，调用KaTeX自动渲染页面中的公式
renderMathInElement(document.getElementById('articleContent'), {
  delimiters: [
    { left: '$$', right: '$$', display: true }, // 块级公式
    { left: '$', right: '$', display: false } // 行内公式
  ],
  throwOnError: false
});

        // 设置页面标题
        document.title = `${info.title} - 我的博客`;

      } catch (error) {
        document.getElementById('articleContent').innerHTML = `<div>加载失败：${error.message}</div>`;
        console.error('加载文章出错：', error);
      }
    }

    // 格式化日期
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return `${date.getFullYear()}年${date.getMonth() + 1}月${date.getDate()}日`;
    }

    // 页面加载完成后初始化
    window.onload = init;
</script>
</html>