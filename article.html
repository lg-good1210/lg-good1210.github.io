<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="utf-8">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js"></script>
    <title>The Blog of good1210's</title>
</head>
<link rel="stylesheet" href="init/main.css">
<style>
    @font-face {
    font-family: '楷体';
    src: url("init/simkai.ttf");
}
    @font-face {
        font-family: 'Consolas normal';
        src: url("init/consola.ttf");
    }
</style>

<body style="font-family: 'Consolas normal', '楷体';">
    <!-- <a href="index.html" class="back-btn">返回首页</a> -->
     <ul class="main-container">
        <li><a>The Blog of Github Pages of Good1210's, good1210 on Luogu(洛谷)</a></li>
        <li><a href="index.html">主页</a></li>
        <li><a href="index.html#about">个人简介、信息</a></li>
        <li><a href="index.html#articles">文章列表</a></li>
    </ul>
    
    <h1 style="text-align: center;" class="title" id="articleTitle"></h1>
    <div class="article-content">
      <div class="markdown" id="articleContent">
        <!-- Markdown内容将在这里渲染 -->
        <div class="loading">加载文章中...</div>
      </div>
    </div>
    <div style="text-align: right;" class="date" id="articleDate"></div>
    <div style="text-align: center; color:rgb(150, 150, 150);">
        Created by Github Pages, modified by Good1210 on Github/Luogu.
    </div>
</body>
<script>
    // 从URL参数获取日期文件夹名
    function getFolderFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return params.get('folder');
    }

    // 初始化：加载文章内容
    async function init() {
      const folder = getFolderFromUrl();
      
      if (!folder) {
        document.getElementById('articleContent').innerHTML = '<div>无效的文章路径</div>';
        return;
      }

      try {
        // 加载文章信息（标题、摘要等）
        const infoResponse = await fetch(`article/${folder}/info.json`);
        if (!infoResponse.ok) throw new Error('文章信息不存在');
        const info = await infoResponse.json();

        // 加载Markdown内容
        const contentResponse = await fetch(`article/${folder}/content.md`);
        if (!contentResponse.ok) throw new Error('文章内容不存在');
        const markdownContent = await contentResponse.text();

        // 渲染页面
        document.getElementById('articleTitle').textContent = '文章：' + info.title;
        document.getElementById('articleDate').textContent = formatDate(folder);
        // 将Markdown转换为HTML并渲染
        document.getElementById('articleContent').innerHTML = marked.parse(markdownContent);

        // 解析完成后，调用KaTeX自动渲染页面中的公式
renderMathInElement(document.getElementById('articleContent'), {
  delimiters: [
    { left: '$$', right: '$$', display: true }, // 块级公式
    { left: '$', right: '$', display: false } // 行内公式
  ],
  throwOnError: false
});

        // 设置页面标题
        document.title = `${info.title} - good1210的博客`;

      } catch (error) {
        document.getElementById('articleContent').innerHTML = `<div>加载失败：${error.message}</div>`;
        console.error('加载文章出错：', error);
      }
    }

function formatDate(dateStr) {
  // 正则匹配格式：YYYY-MM-DD-HH-mm（允许数字间的分隔符为 - 或 _）
  const regex = /^(\d{4})[-_](\d{2})[-_](\d{2})[-_](\d{2})[-_](\d{2})$/;
  const match = dateStr.match(regex);

  if (!match) {
    // 格式不匹配时，返回原始字符串（避免显示异常）
    return dateStr;
  }

  // 提取匹配到的年、月、日、时、分
  const year = match[1];
  const month = parseInt(match[2], 10); // 转为数字（去除前导0，如 09 → 9）
  const day = parseInt(match[3], 10);
  const hour = match[4];
  const minute = match[5];

  // 验证日期合法性（避免 2025-13-32 这种无效日期）
  const validDate = new Date(year, month - 1, day, hour, minute);
  if (
    validDate.getFullYear() != year ||
    validDate.getMonth() + 1 != month ||
    validDate.getDate() != day ||
    validDate.getHours() != hour ||
    validDate.getMinutes() != minute
  ) {
    return dateStr; // 日期无效时返回原始字符串
  }

  // 格式化输出（例：2025年10月23日 14:30）
  return `${year}年${month}月${day}日 ${hour}:${minute}`;
}

    // 页面加载完成后初始化
    window.onload = init;
</script>
</html>